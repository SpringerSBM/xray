{"google":"","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"xray","tagline":"XQuery test framework","body":"**xray** is a framework for writing XQuery unit tests on MarkLogic Server. Test cases are written as standard XQuery functions like this:  \r\n\r\n```xquery\r\ndeclare function string-equality-example()\r\n{\r\n  let $foo := \"foo\"\r\n  return assert:equal($foo, \"foo\")\r\n};\r\n```\r\n\r\n## Getting Started\r\n* Clone/copy/symlink xray into the root directory of your project e.g.<br/>\r\n`git clone git://github.com/robwhitby/xray.git`\r\nor\r\n`git submodule add git://github.com/robwhitby/xray.git` \r\n* Create an HTTP app server pointing to the root directory of your project.\r\n* Check all is well at `http://server:port/xray/`\r\n* Write some tests..\r\n\r\n\r\n## Writing Tests\r\nTests are grouped into library modules in the xray test namespace. Import the xray assertions module along with the modules to be tested.\r\n\r\n```xquery\r\nxquery version \"1.0-ml\";\r\nmodule namespace test = \"http://github.com/robwhitby/xray/test\";\r\nimport module namespace assert = \"http://github.com/robwhitby/xray/assertions\" at \"/xray/src/assertions.xqy\";\r\n\r\nimport module namespace some-module = \"http://some-module-to-test\" at \"/some-module-to-test.xqy\";\r\n\r\ndeclare function string-equality-example()\r\n{\r\n  let $foo := some-module:foo()\r\n  return assert:equal($foo, \"foo\")\r\n};\r\n\r\ndeclare function multiple-assert-example()\r\n{\r\n  let $foo := some-module:foo()\r\n  let $bar := \"bar\"\r\n  return (\r\n    assert:not-empty($foo),\r\n    assert:equal($foo, \"foo\"),\r\n    assert:not-equal($foo, $bar)\r\n  )\r\n};\r\n\r\n(: more tests :)\r\n```\r\n\r\n## Invoking Tests\r\n**xray** will find and execute all the test cases defined in a directory (including sub-directories), and can be told to execute a subset by specifying regex patterns to match tests by module name or test name.\r\n\r\n* browser - `http://server:port/xray/`\r\n* command line - test-runner.sh is a sample shell script, edit the default vars (tested on OSX only).\r\n* invoke from xquery - import `src/xray.xqy` and call `xray:run-tests()`. See `index.xqy` for example.\r\n\r\n\r\n## Parameters\r\n`dir` - test directory path relative from the app server modules root. Optional, defaults to \"test\".\r\n\r\n`modules` - regex match on module name. Optional, default to match all.\r\n\r\n`tests` - regex match on test name. Optional, defaults to match all.\r\n\r\n`format` - set output format to html, xml or text. Optional, defaults to html.\r\n\r\n## Assertions\r\n```xquery\r\nassert:equal($actual as item()*, $expected as item()*)\r\n```\r\n```xquery\r\nassert:not-equal($actual as item()*, $expected as item()*)\r\n```\r\n```xquery\r\nassert:empty($actual as item()*)\r\n```\r\n```xquery\r\nassert:not-empty($actual as item()*)\r\n```\r\n```xquery\r\nassert:error($actual as item()*, $expected-error-name as xs:string)\r\n```\r\n```xquery\r\nassert:true($actual as item()*)\r\n```\r\n```xquery\r\nassert:false($actual as item()*)\r\n```\r\nSee `src/assertions.xqy` for the assertion definitions.\r\n\r\n## Setup and teardown functions\r\n`setup()` and `teardown()` are special function signatures. If defined, `setup()` is invoked before any tests, and in a different transaction so any database updates are visible to the tests. `teardown()` is executed after all tests in that module have finished.\r\n\r\nSee `test/tests.xqy` for an example.\r\n\r\n## Ignoring Tests \r\nTests can be ignored by addding the prefix `IGNORE` to the test function name.\r\n\r\n```xquery\r\ndeclare function IGNORE-this-test-will-be-ignored()\r\n```\r\n\r\n## MarkLogic Configuration\r\nThe app server user must belong to a role with the following execute privileges:\r\n`xdmp:eval`, `xdmp:filesystem-directory`, `xdmp:filesystem-file`, `xdmp:invoke`, `xdmp:xslt-invoke`\r\n\r\nTo work with modules stored in a modules database, the additional privileges are required:\r\n`xdmp:eval-in`\r\nAnd the user must have read rights to files in the modules db.\r\n\r\nTest modules must be written in XQuery version \"1.0-ml\" to be parsed correctly.\r\n\r\n\r\n## Acknowledgements\r\nThanks to Gunther Rademacher's [REx Parser Generator](http://www.bottlecaps.de/rex/) and [John Snelson](http://github.com/jpcs) for the XQuery 1.0-ml parser.\r\n\r\n&nbsp;\r\n## Screenshots\r\n![screenshot of html output](https://github.com/robwhitby/xray/raw/master/screenshot-html.png)\r\n![screenshot of terminal output](https://github.com/robwhitby/xray/raw/master/screenshot-terminal.png)"}